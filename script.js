let jsonAppl = {
    "items": [{
        "id": 0,
        "name": "1",
        "type": "2",
        "location": "3",
        "events": [{
            "id": "0",
            "name": "event 1",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 1",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "2",
            "name": "event 1",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "3",
            "name": "event 1",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "4",
            "name": "event 1",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        }
        ]
    },
    {
        "id": 1,
        "name": "2",
        "type": "2",
        "location": "3",
        "events": [{
            "id": "0",
            "name": "event 2",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 2",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "2",
            "name": "event 2",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        }
        ]
    },
    {
        "id": 2,
        "name": "3",
        "type": "2",
        "location": "3",
        "events": [{
            "id": "0",
            "name": "event 88",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 5435",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "2",
            "name": "event 12",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        }
        ]
    },
    {
        "id": 3,
        "name": "4",
        "type": "2",
        "location": "3",
        "events": [{
            "id": "0",
            "name": "event 3",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 3",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "2",
            "name": "event 3",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 3",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 3",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 3",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        }
        ]
    },
    {
        "id": 4,
        "name": "5",
        "type": "2",
        "location": "3",
        "events": [{
            "id": "0",
            "name": "event 4",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "1",
            "name": "event 4",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        },
        {
            "id": "2",
            "name": "event 4",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        }
        ]
    },
    {
        "id": 5,
        "name": "6",
        "type": "2",
        "location": "3",
        "events": [{
            "id": "0",
            "name": "event 5",
            "time": "05:17",
            "I1": [100, 10],
            "I2": [10000, 20],
            "I3": [100, 10],
            "U1": [10000, 20],
            "U2": [100, 10],
            "U3": [10000, 20]
        }
        ]
    },
    {
        "id": 6,
        "name": "7",
        "type": "2",
        "location": "3",
        "events": []
    }
    ]
}

let menuStart = document.querySelector('.hideBar__start');
let menuUl = document.querySelector('.hideBar__ul');
let menuLi = document.querySelector('.hideBar__li');
let menuItems = document.querySelectorAll('.menuItem');
let addDefault = document.querySelector('.addDefault');


let elements = document.querySelectorAll('.workspace__area');
for (let i = 0; i < elements.length; i++) {
    let sortable = Sortable.create(elements[i], {
        group: "workspace",
        draggable: '.window',
        animation: 150
    });
}


class Window {
    constructor(areaNumber) {
        this.name = "default window";
        this.window = document.createElement("div");
        this.window.classList.add("window");

        this.controlPanel = document.createElement("div");
        this.controlPanel.classList.add("window__controlPanel");

        this.title = document.createElement("p");
        this.title.classList.add("window__title");
        this.title.innerHTML = this.name;


        this.controls = document.createElement("div");
        this.controls.classList.add("window__controls");

        this.button = document.createElement("div");
        this.button.classList.add("window__hide");
        handler(this.button, this, "hide");
        this.controls.append(this.button);
        this.button = document.createElement("div");
        this.button.classList.add("window__resize");
        handler(this.button, this, "resize");
        this.controls.append(this.button);
        this.button = document.createElement("div");
        this.button.classList.add("window__close");
        handler(this.button, this, "close");
        this.controls.append(this.button);
        // потом переделаю в цикл

        this.legend = document.createElement("div");
        this.legend.classList.add("window__legend");

        this.content = document.createElement("div");
        this.content.classList.add("window__content");

        this.window.append(this.controlPanel);
        this.window.append(this.legend);
        this.window.append(this.content);
        this.controlPanel.append(this.title);
        this.controlPanel.append(this.controls);

        let areas = document.querySelectorAll(".workspace__area")
        if ((areaNumber < 0) || (areaNumber > 2)) {
            areas[2].append(this.window);
            alert(`Элемент "${this.name}" автоматически установлен в конец`)
        } else {
            for (let i = 0; i < areas.length; i++) {
                areas[areaNumber].append(this.window);
            }
        }

        function handler(target, obj, type) {
            target.addEventListener("click", function (e) {
                e.stopPropagation();
                if (type == "hide") {
                    obj.hide();
                } else if (type == "resize") {
                    obj.resize();
                } else if (type == "close") {
                    obj.close();
                }
            })
        }
    }

    hide() {
        let parent = this.window.parentNode;
        let window = this.window;
        window.classList.add("hidden");
        document.querySelector(".hideBar").append(window);
        window.addEventListener("click", function (e) {
            this.classList.remove("hidden");
            parent.append(this);
        })
    }

    resize() {
        this.window.classList.toggle("maximize");

    }

    close() {
        this.window.style.display = "none";
    }
}

class WindowItems extends Window {
    constructor(areaNumber) {
        super(areaNumber);
        this.name = "Список приборов";
        this.title.innerHTML = this.name;
        this.eventsObject = new WindowEvents(areaNumber);

        for (let i = 0; i < 4; i++) {
            let col = document.createElement("p");
            col.classList.add("legend__item")
            switch (i) {
                case 0:
                    col.innerHTML = "id";
                    col.classList.add("id")
                    break;
                case 1:
                    col.innerHTML = "Имя прибора";
                    col.classList.add("name")
                    break;
                case 2:
                    col.innerHTML = "Тип прибора";
                    col.classList.add("type")
                    break;
                case 3:
                    col.innerHTML = "Местоположение";
                    col.classList.add("location")
                    break;
            }
            this.legend.append(col);
        }
        this.fill();
    }

    fill() {
        // local
        requestHandler(this, jsonAppl, this.eventsObject);

        function requestHandler(object, jsonsmth, eventsObject) {
            let appliances = jsonsmth;
            let itemsCount = appliances.items.length;

            pageCreator(object, itemsCount, appliances, eventsObject);

            let rows = document.querySelectorAll(".row");

            for (let i = 0; i < itemsCount; i++) {
                rows[i].querySelector('.id').innerHTML = appliances.items[i].id;
                rows[i].querySelector('.name').innerHTML = appliances.items[i].name;
                rows[i].querySelector('.type').innerHTML = appliances.items[i].type;
                rows[i].querySelector('.location').innerHTML = appliances.items[i].location;
            }
        }

        function pageCreator(object, itemsCount, appliances, eventsObject) {
            for (let i = 0; i < itemsCount; i++) {
                let row = document.createElement("div");
                row.classList.add("row");

                row.addEventListener("click", function () {
                    let id = this.querySelector(".id").innerHTML;
                    for (let k = 0; k < appliances.items.length; k++) {
                        if (appliances.items[k].id == id) {
                            eventsObject.fill(appliances, id);
                        }
                    }
                })

                for (let j = 0; j < 4; j++) {
                    let col = document.createElement("div");
                    col.classList.add("col");
                    switch (j) {
                        case 0:
                            col.classList.add("id")
                            break;
                        case 1:
                            col.classList.add("name")
                            break;
                        case 2:
                            col.classList.add("type")
                            break;
                        case 3:
                            col.classList.add("location")
                            break;
                    }
                    row.append(col);
                }
                object.window.querySelector('.window__content').append(row);
            }
        }

        // web

        // requestHandler(this, "appliances.json", this.eventsObject);

        // function requestHandler(object, way, eventsObject) {
        //     let requestURL = way;
        //     let xhr = new XMLHttpRequest();

        //     xhr.open("GET", requestURL);
        //     xhr.responseType = 'json';
        //     xhr.onerror = function(){console.log("oops")};
        //     xhr.send();
        // }

        // xhr.addEventListener("load", function() {
        //     let appliances = request.response;
        //     let itemsValue = appliances.items.length;
        //     let rowsPerPage = Math.floor(object.window.querySelector('.window__content').offsetHeight / 50);

        //     pageCreator(object, itemsValue, rowsPerPage, appliances, eventsObject);
        //     let rows = object.window.querySelectorAll('.row');
        //     for (let k = 0; k < itemsValue; k++) {
        //         rows[k].querySelector('.id').innerHTML = appliances.items[k].id;
        //         rows[k].querySelector('.name').innerHTML = appliances.items[k].name;
        //         rows[k].querySelector('.type').innerHTML = appliances.items[k].type;
        //         rows[k].querySelector('.location').innerHTML = appliances.items[k].location;
        //     }
        // });
    }
}



class WindowEvents extends Window {
    constructor(areaNumber) {
        super(areaNumber);
        this.name = "События";
        this.title.innerHTML = this.name;

        for (let i = 0; i < 8; i++) {
            let col = document.createElement("p");
            col.classList.add("legend__item__event");
            switch (i) {
                case 0:
                    col.innerHTML = "Тип события";
                    break;
                case 1:
                    col.innerHTML = "Время соб.";
                    break;
                case 2:
                    col.innerHTML = "I1 макс,мин";
                    break;
                case 3:
                    col.innerHTML = "I2 макс,мин";
                    break;
                case 4:
                    col.innerHTML = "I3 макс,мин";
                    break;
                case 5:
                    col.innerHTML = "U1 макс,мин";
                    break;
                case 6:
                    col.innerHTML = "U2 макс,мин";
                    break;
                case 7:
                    col.innerHTML = "U3 макс,мин";
                    break;
            }
            this.legend.append(col);
        }
    }
    fill(jsonAppl, id) {

    }
}


// let defaultWindow = new Window(0);
// let defaultWindow3 = new Window(2);
let itemWindow = new WindowItems(1);
// let eventsWindow = new WindowEvents(2);


menuStart.addEventListener("click", function () {
    menuStart.classList.add("active");
    menuUl.classList.add("active");
    menuLi.classList.add("active");
});

window.addEventListener("mousemove", function (e) {
    if ((e.clientX > 40) || (e.clientY < (window.innerHeight - 150))) {
        menuStart.classList.remove("active");
        menuUl.classList.remove("active");
        menuLi.classList.remove("active");
    }
})

addDefault.addEventListener("click", function (e) {
    e.stopPropagation;
    new Window(0);
})